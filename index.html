---
layout: default
title: Brisbane WW2 Sites
---
<h1>Brisbane WW2 Sites</h1>

<div class="btn-group pull-right">
    <a id="locate-button" class="btn btn-default text-primary">Locate</a>
    <a id="pin-locate-button" class="btn btn-default"><span class="glyphicon glyphicon-pushpin"></span></a>
    <a id="unpin-locate-button" class="btn btn-default text-danger"><span class="glyphicon glyphicon-remove"></span></a>
</div>

<h2>Map of WW2 sites</h2>

<div id="map"></div><br />

<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title infoTitle">Selected item</h3>
    </div>
    <div class="panel-body infoWindow">
        Select a shape on the map for more info
    </div>
</div>

<script type="text/javascript">
var map;
var mapTracking = false;
var trackingTimer;
var trackingMarker;
function initMap() {
    map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: -27.4710, lng: 153.0234 },
        mapTypeId: google.maps.MapTypeId.SATELLITE,
        zoom: 12
    });

    var kmlLayer = new google.maps.KmlLayer({
        url: 'http://simonhazelgrove.github.io/brisbaneww2/kml/BrisbaneWW2.kml',
        map: map
    });

    kmlLayer.addListener("click", function (kmlEvent) {
        $(".infoTitle").html(kmlEvent.featureData.name);
        $(".infoWindow").html(kmlEvent.featureData.infoWindowHtml);
        //kmlEvent.stop();
    });

    $("#locate-button").click(function (event) {
        if (!mapTracking) {
            locateMe();
        }
    });

    $("#pin-locate-button").click(function (event) {
        $("#locate-button").toggleClass("active");
        $("#pin-locate-button").hide();
        $("#unpin-locate-button").show();
        startTracking();
    });

    $("#unpin-locate-button").hide();
    $("#unpin-locate-button").click(function (event) {
        endTracking();
        $("#locate-button").toggleClass("active");
        $("#unpin-locate-button").hide();
        $("#pin-locate-button").show();
        hideMarker();
    });
}

function locateMe() {
    // Try HTML5 geolocation.
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (position) {
            var pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
            };
            map.setCenter(pos);
            setMarker(pos);
        }, function () {
            // Intermitent error?
        });
    } else {
        // Browser doesn't support Geolocation
        handleLocationError(false);
    }
}

function setMarker(pos) {
    if (trackingMarker == null) {
        trackingMarker = new google.maps.Marker({
            position: pos,
            map: map,
            title: 'Me!'
        });
    } else {
        trackingMarker.setPosition(pos);
        trackingMarker.setMap(map);
    }
}

function hideMarker() {
    if (trackingMarker != null) {
        trackingMarker.setMap(null);
    }
}

function handleLocationError(browserHasGeolocation, infoWindow, pos) {
    if (mapTracking) {
        endTracking();
    }
    //$("#locate-button").attr('disabled', 'disabled');
}


function startTracking() {
    locateMe();
    trackingTimer = setInterval(locateMe, 5000);
    mapTracking = true;
}

function endTracking() {
    clearTimeout(trackingTimer);
    mapTracking = false;
}

</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBaJ5fpfHJYrQeodzvWfaiQAE09SjYUPMY&callback=initMap" async defer></script>
